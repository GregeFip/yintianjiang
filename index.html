<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>引天降 · 太岁禄马贵人飞宫</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #1a1a1a; color: #e5e5e5; font-family: "PingFang SC", "STHeiti", sans-serif; -webkit-font-smoothing: antialiased; }
        .yin-card { background: linear-gradient(145deg, #2a2a2a, #222222); border-top: 3px solid #b91c1c; border-radius: 16px; }
        .palace-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; background: #333; border: 2px solid #333; border-radius: 8px; overflow: hidden; }
        .palace-cell { background: #1f1f1f; aspect-ratio: 1/1; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; padding: 4px; }
        .palace-name { font-size: 11px; color: #666; position: absolute; top: 4px; left: 4px; }
        .active-god { font-size: 11px; text-align: center; transform: scale(0.9); line-height: 1.2; }
        .btn-gold { background: linear-gradient(to right, #b91c1c, #991b1b); color: white; transition: all 0.2s; box-shadow: 0 4px 15px rgba(185, 28, 28, 0.3); }
        .btn-gold:active { transform: scale(0.96); opacity: 0.9; }
        select { -webkit-appearance: none; background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='white'%3E%3Cpath d='M7 10l5 5 5-5z'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 8px center; background-size: 16px; }
    </style>
</head>
<body class="p-3">
    <div class="max-w-md mx-auto">
        <header class="text-center py-6">
            <h1 class="text-2xl font-bold tracking-[0.2em] text-red-600">引天降</h1>
            <p class="text-[10px] text-gray-500 mt-1">太岁禄马贵人飞宫精算工具</p>
        </header>

        <div class="yin-card p-5 mb-4 shadow-2xl">
            <div class="grid grid-cols-2 gap-3 mb-4">
                <div>
                    <label class="block text-[10px] text-gray-400 mb-1">选择流年</label>
                    <select id="y" class="w-full bg-zinc-800 border-none rounded-lg p-3 text-sm focus:ring-1 focus:ring-red-600"></select>
                </div>
                <div>
                    <label class="block text-[10px] text-gray-400 mb-1">用事月份</label>
                    <select id="m" class="w-full bg-zinc-800 border-none rounded-lg p-3 text-sm">
                        <option value="1">正月(寅)</option><option value="2">二月(卯)</option>
                        <option value="3">三月(辰)</option><option value="4">四月(巳)</option>
                        <option value="5">五月(午)</option><option value="6">六月(未)</option>
                        <option value="7">七月(申)</option><option value="8">八月(酉)</option>
                        <option value="9">九月(戌)</option><option value="10">十月(亥)</option>
                        <option value="11">十一月(子)</option><option value="12">十二月(丑)</option>
                    </select>
                </div>
            </div>
            <div class="flex gap-4 mb-4 text-xs justify-center bg-zinc-900/50 py-2 rounded-lg">
                <label class="flex items-center gap-1"><input type="radio" name="d" value="y" checked class="accent-red-600"> 冬至后(阳)</label>
                <label class="flex items-center gap-1"><input type="radio" name="d" value="i" class="accent-red-600"> 夏至后(阴)</label>
            </div>
            <button onclick="calc()" class="w-full btn-gold py-3 rounded-xl font-bold text-sm tracking-widest">开始推演</button>
        </div>

        <div id="res" class="hidden animate-in fade-in zoom-in duration-300">
            <div class="text-center mb-3 text-xs text-gray-400">
                <span id="mGZ" class="text-red-500 font-bold"></span> 月入中宫 · <span id="dD"></span>
            </div>
            <div class="palace-grid mb-4">
                <div class="palace-cell" id="p4"><span class="palace-name">巽</span><div class="active-god"></div></div>
                <div class="palace-cell" id="p9"><span class="palace-name">离</span><div class="active-god"></div></div>
                <div class="palace-cell" id="p2"><span class="palace-name">坤</span><div class="active-god"></div></div>
                <div class="palace-cell" id="p3"><span class="palace-name">震</span><div class="active-god"></div></div>
                <div class="palace-cell" id="p5" style="background: #2a2121;"><span class="palace-name">中</span><div class="active-god"></div></div>
                <div class="palace-cell" id="p7"><span class="palace-name">兑</span><div class="active-god"></div></div>
                <div class="palace-cell" id="p8"><span class="palace-name">艮</span><div class="active-god"></div></div>
                <div class="palace-cell" id="p1"><span class="palace-name">坎</span><div class="active-god"></div></div>
                <div class="palace-cell" id="p6"><span class="palace-name">乾</span><div class="active-god"></div></div>
            </div>
            
            <div class="space-y-2 text-[11px]">
                <div id="iL" class="bg-red-950/20 p-3 rounded-lg border-l-2 border-red-600 flex justify-between"></div>
                <div id="iM" class="bg-blue-950/20 p-3 rounded-lg border-l-2 border-blue-600 flex justify-between"></div>
                <div id="iY" class="bg-purple-950/20 p-3 rounded-lg border-l-2 border-purple-600 flex justify-between"></div>
                <div id="iN" class="bg-zinc-800 p-3 rounded-lg border-l-2 border-gray-400 flex justify-between"></div>
            </div>
        </div>
    </div>

    <script>
        const S="甲乙丙丁戊己庚辛壬癸", B="子丑寅卯辰巳午未申酉戌亥", J=[];
        for(let i=0;i<60;i++) J.push(S[i%10]+B[i%12]);

        const yS = document.getElementById('y'), now = new Date().getFullYear();
        for(let i=now+15;i>=now-85;i--){
            let o=(i-4)%60; if(o<0)o+=60;
            yS.add(new Option(`${i}年(${S[o%10]}${B[o%12]})`, i));
        }
        yS.value = now;

        function calc(){
            const y=parseInt(yS.value), m=parseInt(document.getElementById('m').value), isY=document.querySelector('input[name="d"]:checked').value==='y';
            let o=(y-4)%60; if(o<0)o+=60; let s=S[o%10], b=B[o%12];

            const getG=(tb)=>{
                const st={"甲":2,"己":2,"乙":4,"庚":4,"丙":6,"辛":6,"丁":8,"壬":8,"戊":0,"癸":0}[s];
                return S[(st+(B.indexOf(tb)-2+12)%12)%10]+tb;
            };

            const lB={"甲":"寅","乙":"卯","丙":"巳","丁":"午","戊":"巳","己":"午","庚":"申","辛":"酉","壬":"亥","癸":"子"}[s];
            const mB={"申":"寅","子":"寅","辰":"寅","寅":"申","午":"申","戌":"申","巳":"亥","酉":"亥","丑":"亥","亥":"巳","卯":"巳","未":"巳"}[b];
            const ayB={"甲":"丑","乙":"子","丙":"亥","丁":"亥","戊":"丑","己":"子","庚":"丑","辛":"午","壬":"卯","癸":"卯"}[s];
            const aiB={"甲":"未","乙":"申","丙":"酉","丁":"酉","戊":"未","己":"申","庚":"未","辛":"寅","壬":"巳","癸":"巳"}[s];

            const lG=getG(lB), mG=getG(mB), yG=getG(ayB), nG=getG(aiB);
            const mbB=B[(m+1)%12], msS=S[({"甲":2,"己":2,"乙":4,"庚":4,"丙":6,"辛":6,"丁":8,"壬":8,"戊":0,"癸":0}[s]+(m-1))%10];
            const mGZ=msS+mbB;

            const path=isY?[5,6,7,8,9,1,2,3,4]:[5,4,3,2,1,9,8,7,6];
            const getP=(gz)=>{ let st=(J.indexOf(gz)-J.indexOf(mGZ)+60)%60; return path[st%9]; };

            document.querySelectorAll('.active-god').forEach(e=>e.innerHTML="");
            const ren=(gz,lb,cl,id)=>{
                const p=getP(gz), pN=document.querySelector(`#p${p} .palace-name`).innerText;
                document.querySelector(`#p${p} .active-god`).innerHTML+=`<div class="${cl} font-bold">${lb}<br><span class='text-[8px] font-normal'>${gz}</span></div>`;
                document.getElementById(id).innerHTML=`<span><b>${lb}</b> ${gz}</span> <span>飞：${pN}宫</span>`;
            };

            document.getElementById('res').classList.remove('hidden');
            document.getElementById('mGZ').innerText=mGZ;
            document.getElementById('dD').innerText=isY?"阳遁顺飞":"阴遁逆飞";
            ren(lG,"真禄","text-red-500","iL"); ren(mG,"真马","text-blue-400","iM"); 
            ren(yG,"阳贵","text-purple-400","iY"); ren(nG,"阴贵","text-gray-400","iN");
            window.scrollTo({top: document.body.scrollHeight, behavior: 'smooth'});
        }
    </script>
</body>
</html>